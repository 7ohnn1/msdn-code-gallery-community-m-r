<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps;/Areas/Centers/Themes/StandardDevCenter/Content:0&amp;amp;v=46D0EADCABBE3E18DF970254C2C182AB" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:NewFooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=D4D084DF03A9CB234D78334671AC996E" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Populate DataGridView via asynchronously methods</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Populate DataGridView via asynchronously methods</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            ADO.NET, Data Access, threading, .NET Framework, Visual Basic .NET, Windows UI, DataGridView, Async, .NET Framework 4.5
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Data Binding, Asynchronous Programming, User Interface, Windows Forms, Data Access, threading, Visual Basic .NET, How to
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Data
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">11/2/2016</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/Populate-DataGridView-via-a3ede35a">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1><span style="font-size:20px; font-weight:bold">Description</span></h1>
<p><span style="font-size:small">This article presents one method to load a DataGridView from a backend database table where the user interface remains responsive using features new to Visual Studio 2012 and higher which includes VB.NET Iterator method in tangent
 with Yield statement plus Async modifier and Await operator.</span></p>
<p><span style="font-size:small"><strong>UPDATE 11/02/2016</strong> Minor changes and included scripts for generating database and table. Also upgraded from VS2013 to VS2015.</span></p>
<p><span style="font-size:small"><strong>UPDATE 4/15/2016</strong> If using SQL-Server, change RowCount to Row_Count in DataAccess.RowCount&nbsp;</span></p>
<p><span style="font-size:small">&nbsp;</span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>Visual Basic</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">vb</span>
<pre class="hidden">Using cmd As New SqlClient.SqlCommand With {.CommandText = &quot;SELECT COUNT(Identifier) As Row_Count FROM [People]&quot;, .Connection = cn}</pre>
<div class="preview">
<pre class="js">Using&nbsp;cmd&nbsp;As&nbsp;New&nbsp;SqlClient.SqlCommand&nbsp;With&nbsp;<span class="js__brace">{</span>.CommandText&nbsp;=&nbsp;<span class="js__string">&quot;SELECT&nbsp;COUNT(Identifier)&nbsp;As&nbsp;Row_Count&nbsp;FROM&nbsp;[People]&quot;</span>,&nbsp;.Connection&nbsp;=&nbsp;cn<span class="js__brace">}</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size:small"><strong>UPDATE 11/21/2015</strong> Added a C# project to mirror the original VB.NET project. Also added an example to use a progressbar to both C# and VB.NET. Lastly, the original database had 1M records which made it a physically
 large file so I reduced the records to 1,000 as when intially uploading strange things happened.<br>
<br>
<strong>NOTE:<span style="color:#ff0000">&nbsp;The code presented works with VS2013 or higher</span></strong>.<br>
</span></p>
<p><span style="font-size:small">The goal here is to press a button on a form, load rows of data from a class to the caller which is a form into a DataTable where the DataTable is currently the DataSource of a DataGridView. During the load process we allow
 the user to cancel the operation.</span></p>
<p><span style="font-size:small">Since the managed data providers in the Framework work well I elected to use a table with three fields with one million rows. Okay, that is a lot of rows but it's for demonstration purposes only as when data is presented to
 users 99.99% of the time they never need that many rows at once but I have seen developers wanting this on various forums on the web hence this will appease those developers.</span></p>
<p><span style="font-size:small">In the class DataAccess there is a function named LoadCustomers which is setup with a Iterator keyword which returns an Object array. The Object elements contain three items which represent data retrieved from the database table
 that is passed to a delegate in the caller (form) which adds a new row to the DataTable in the main form. LoadCustomers is called in a button setup with Async that iterates the items in LoadCustomers but our task does nothing which keeps us responsive while
 the delegate UpDateDataTable in the form does the adding of Datarows to the DataTable in the form.</span></p>
<p><span style="font-size:small">While populating the DataTable we can cancel the operation via a CancellationToken rather than making the user have to wait even thou they don't want to wait.<br>
<br>
Now the backend database is MS-Access yet what is presented can and will work with other managed data providers in the Framework. Also the pattern presented can be used for other operations (I have a upcoming article on doing splash screens which use similar
 methods as shown here).<br>
<br>
UPDATE: The original database had three tables and only needed one so two were removed while the one needed was reduced from 100,000,000 records to 100,000 records since the original was very large 126MB and is now just under 400MB.<br>
<img id="120272" src="description/S1.png" alt="" width="756" height="485"><br>
</span></p>
<p><span style="font-size:small">&nbsp;</span></p>
<p><img id="120216" src="description/9d301043-c31d-471b-898e-d6537b19fdd1S1.png" alt="" width="354" height="239"></p>
<p><em>.&nbsp;&nbsp;&nbsp;</em></p>
<p>&nbsp;</p>
<h1><span>&nbsp;</span></h1>
<h1><span>&nbsp;</span></h1>

</div>


    </div>
</body>
</html>
