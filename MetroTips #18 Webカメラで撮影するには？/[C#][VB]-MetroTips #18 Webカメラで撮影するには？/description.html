<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=E26C1359372FE948C3C39B3F0FB94413" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/1694db62-a583-4054-8595-31d1fa950b6aCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=76DF6246C5394201214B48DD1A8F406B" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>MetroTips #18 Webカメラで撮影するには？</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>MetroTips #18 Webカメラで撮影するには？</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="テクノロジ">テクノロジ</label>
                        <div id="テクノロジ">
                            Windows 8, Windows RT, Windows Store app
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="トピック">トピック</label>
                        <div id="トピック">
                            Audio and video, web camera, CameraCaptureUI<wbr />, CaptureElement, MediaCapture
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Windows RT
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">ja-JP</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">最終更新日</label>
                    <div id="LastUpdated">2012/12/20</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">ライセンス</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/MetroTips-18-Web-452e5138">このサンプルをオンラインで表示する</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'コードをコピー';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div>これは次の記事のサンプルコードです。</div>
<blockquote>
<div>@IT 2012/12/20 掲載<br>
<img id="68637" src="description/gyoumu_newallarticle_icon_61_1349480145.gif" alt="" width="80" height="60"><br>
<strong><a href="http://www.atmarkit.co.jp/ait/articles/1212/20/news068.html" >WinRT／Metro TIPS： Webカメラで撮影するには？［Win 8］</a></strong><br>
タブレットPCやノートPCの多くには、「Webカメラ」と呼ばれるカメラが搭載されている。これを使ってWindowsストア・アプリで写真や動画を撮影するには、どうしたらよいだろうか？ 本稿では、Webカメラで写真を撮る方法を説明する。</div>
</blockquote>
<div>以下の解説は記事からの抜粋である。かなり端折ってあるので、ぜひ記事のほうもお読みいただきたい。</div>
<div>&nbsp;</div>
<h1>Building the Sample</h1>
<div>Windows 8 製品版(または評価版) &#43; Visual Studio 2012 製品版(Expressでも可) でビルドしてほしい。<br>
これらを準備するには、<a href="http://www.atmarkit.co.jp/ait/articles/1208/23/news131.html" >第1回のTIPS</a>を参考にしてほしい。本稿では64bit版Win 8 Proと<a href="http://www.microsoft.com/visualstudio/jpn/downloads#d-2012-express" >VS 2012 Express for Windows
 8</a>を使用している。</div>
<div>&nbsp;</div>
<div><img id="73014" src="description/MetroTips018_04.png" alt="" width="480" height="270"></div>
<div>&nbsp;</div>
<h1>Description</h1>
<h2>●簡単に写真を撮るには？</h2>
<div>CameraCaptureUIクラス（Windows.Media.Capture名前空間）を使うと、簡単に写真や動画を撮影できる。撮影用のUI（ユーザー・インターフェイス）が用意されているので、次のようなコードを書くだけでよい。</div>
<div>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>Visual Basic</span><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">スクリプトの編集</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">vb</span><span class="hidden">csharp</span>
<pre class="hidden">' ダイアログ生成
Dim dialog = New Windows.Media.Capture.CameraCaptureUI()

' 写真のフォーマットを指定
dialog.PhotoSettings.Format _
      = Windows.Media.Capture.CameraCaptureUIPhotoFormat.Png

' 写真撮影モードでダイアログを起動
Dim file = Await dialog.CaptureFileAsync(
                    Windows.Media.Capture.CameraCaptureUIMode.Photo)

' 撮影できると、保存されたファイルのStorageFileが返ってくる。
' 保存先はApplicationData.Current.TemporaryFolder固定
If (file IsNot Nothing) Then
  Dim msgbox = New Windows.UI.Popups.MessageDialog(file.Path, &quot;撮影結果&quot;)
  Await msgbox.ShowAsync()
End If</pre>
<pre class="hidden">// ダイアログ生成
var dialog = new Windows.Media.Capture.CameraCaptureUI();

// 写真のフォーマットを指定
dialog.PhotoSettings.Format 
    = Windows.Media.Capture.CameraCaptureUIPhotoFormat.Png;

// 写真撮影モードでダイアログを起動
var file = await dialog.CaptureFileAsync(
                   Windows.Media.Capture.CameraCaptureUIMode.Photo);

// 撮影できると、保存されたファイルのStorageFileが返ってくる。
// 保存先はApplicationData.Current.TemporaryFolder固定
if (file != null)
{
  var msgbox = new Windows.UI.Popups.MessageDialog(file.Path, &quot;撮影結果&quot;);
  await msgbox.ShowAsync();
}</pre>
<div class="preview">
<pre class="vb"><span class="visualBasic__com">'&nbsp;ダイアログ生成</span>&nbsp;
<span class="visualBasic__keyword">Dim</span>&nbsp;dialog&nbsp;=&nbsp;<span class="visualBasic__keyword">New</span>&nbsp;Windows.Media.Capture.CameraCaptureUI()&nbsp;
&nbsp;
<span class="visualBasic__com">'&nbsp;写真のフォーマットを指定</span>&nbsp;
dialog.PhotoSettings.Format&nbsp;_&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Windows.Media.Capture.CameraCaptureUIPhotoFormat.Png&nbsp;
&nbsp;
<span class="visualBasic__com">'&nbsp;写真撮影モードでダイアログを起動</span>&nbsp;
<span class="visualBasic__keyword">Dim</span>&nbsp;file&nbsp;=&nbsp;Await&nbsp;dialog.CaptureFileAsync(&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Windows.Media.Capture.CameraCaptureUIMode.Photo)&nbsp;
&nbsp;
<span class="visualBasic__com">'&nbsp;撮影できると、保存されたファイルのStorageFileが返ってくる。</span>&nbsp;
<span class="visualBasic__com">'&nbsp;保存先はApplicationData.Current.TemporaryFolder固定</span>&nbsp;
<span class="visualBasic__keyword">If</span>&nbsp;(file&nbsp;<span class="visualBasic__keyword">IsNot</span>&nbsp;<span class="visualBasic__keyword">Nothing</span>)&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;msgbox&nbsp;=&nbsp;<span class="visualBasic__keyword">New</span>&nbsp;Windows.UI.Popups.MessageDialog(file.Path,&nbsp;<span class="visualBasic__string">&quot;撮影結果&quot;</span>)&nbsp;
&nbsp;&nbsp;Await&nbsp;msgbox.ShowAsync()&nbsp;
<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">If</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
</div>
<p>&nbsp;</p>
<h2>●独自のUIを構築するには？</h2>
<p>CameraCaptureUIクラスが提供するUIはお仕着せのものだった。CaptureElementコントロール（Windows.UI.Xaml.Controls名前空間）と、MediaCaptureクラス（Windows.Media.Capture名前空間）を使えば、独自のUIを作ることもできる。</p>
<p>こんなUIを作ってみよう。画面の左半分にCaptureElementコントロールを置き、プレビューを表示する。右半分にはImageコントロールを置いて、撮影した画像を表示する。また、下部にはボタンを3つ配置し、左の2つはプレビュー開始、右端は撮影とした。 (完成した画面が上に掲載した画像)</p>
<p>この部分のXAMLコードは次のようになる。</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>XAML</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">スクリプトの編集</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">xaml</span>
<pre class="hidden">&lt;Grid Grid.Row=&quot;1&quot; Background=&quot;#002244&quot;&gt;
  &lt;Grid.RowDefinitions&gt;
    &lt;RowDefinition Height=&quot;*&quot; /&gt;
    &lt;RowDefinition Height=&quot;Auto&quot; /&gt;
  &lt;/Grid.RowDefinitions&gt;

  &lt;Grid&gt;
    &lt;Grid.ColumnDefinitions&gt;
      &lt;ColumnDefinition Width=&quot;1*&quot; /&gt;
      &lt;ColumnDefinition Width=&quot;1*&quot; /&gt;
    &lt;/Grid.ColumnDefinitions&gt;
    &lt;CaptureElement x:Name=&quot;capturePreview&quot; Grid.Column=&quot;0&quot; /&gt;
    &lt;Image x:Name=&quot;captureImage&quot; Grid.Column=&quot;1&quot; /&gt;
  &lt;/Grid&gt;

  &lt;StackPanel Grid.Row=&quot;1&quot; Orientation=&quot;Horizontal&quot; 
      HorizontalAlignment=&quot;Center&quot; Margin=&quot;0,10&quot;&gt;
    &lt;Button  Content=&quot;補正無し&quot; HorizontalAlignment=&quot;Center&quot; FontSize=&quot;40&quot;
      Click=&quot;buttonPreviewClick&quot; /&gt;
    &lt;Button  Content=&quot;手ブレ補正&quot; HorizontalAlignment=&quot;Center&quot; FontSize=&quot;40&quot;
      Click=&quot;buttonPreviewWithVideoStabilizationClick&quot; /&gt;
    &lt;Button  Content=&quot;《 撮影 》&quot; HorizontalAlignment=&quot;Center&quot; FontSize=&quot;40&quot;
      Click=&quot;buttonTakePhotoClick&quot; /&gt;
  &lt;/StackPanel&gt;

&lt;/Grid&gt;</pre>
<div class="preview">
<pre class="xaml"><span class="xaml__tag_start">&lt;Grid</span>&nbsp;Grid.<span class="xaml__attr_name">Row</span>=<span class="xaml__attr_value">&quot;1&quot;</span>&nbsp;<span class="xaml__attr_name">Background</span>=<span class="xaml__attr_value">&quot;#002244&quot;</span><span class="xaml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;<span class="xaml__tag_start">&lt;Grid</span>.RowDefinitions<span class="xaml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;RowDefinition</span>&nbsp;<span class="xaml__attr_name">Height</span>=<span class="xaml__attr_value">&quot;*&quot;</span>&nbsp;<span class="xaml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;RowDefinition</span>&nbsp;<span class="xaml__attr_name">Height</span>=<span class="xaml__attr_value">&quot;Auto&quot;</span>&nbsp;<span class="xaml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;&lt;/Grid.RowDefinitions&gt;&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="xaml__tag_start">&lt;Grid</span><span class="xaml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;Grid</span>.ColumnDefinitions<span class="xaml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;ColumnDefinition</span>&nbsp;<span class="xaml__attr_name">Width</span>=<span class="xaml__attr_value">&quot;1*&quot;</span>&nbsp;<span class="xaml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;ColumnDefinition</span>&nbsp;<span class="xaml__attr_name">Width</span>=<span class="xaml__attr_value">&quot;1*&quot;</span>&nbsp;<span class="xaml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Grid.ColumnDefinitions&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;CaptureElement</span>&nbsp;x:<span class="xaml__attr_name">Name</span>=<span class="xaml__attr_value">&quot;capturePreview&quot;</span>&nbsp;Grid.<span class="xaml__attr_name">Column</span>=<span class="xaml__attr_value">&quot;0&quot;</span>&nbsp;<span class="xaml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;Image</span>&nbsp;x:<span class="xaml__attr_name">Name</span>=<span class="xaml__attr_value">&quot;captureImage&quot;</span>&nbsp;Grid.<span class="xaml__attr_name">Column</span>=<span class="xaml__attr_value">&quot;1&quot;</span>&nbsp;<span class="xaml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;<span class="xaml__tag_end">&lt;/Grid&gt;</span>&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="xaml__tag_start">&lt;StackPanel</span>&nbsp;Grid.<span class="xaml__attr_name">Row</span>=<span class="xaml__attr_value">&quot;1&quot;</span>&nbsp;<span class="xaml__attr_name">Orientation</span>=<span class="xaml__attr_value">&quot;Horizontal&quot;</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__attr_name">HorizontalAlignment</span>=<span class="xaml__attr_value">&quot;Center&quot;</span>&nbsp;<span class="xaml__attr_name">Margin</span>=<span class="xaml__attr_value">&quot;0,10&quot;</span><span class="xaml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;Button</span>&nbsp;&nbsp;<span class="xaml__attr_name">Content</span>=<span class="xaml__attr_value">&quot;補正無し&quot;</span>&nbsp;<span class="xaml__attr_name">HorizontalAlignment</span>=<span class="xaml__attr_value">&quot;Center&quot;</span>&nbsp;<span class="xaml__attr_name">FontSize</span>=<span class="xaml__attr_value">&quot;40&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__attr_name">Click</span>=<span class="xaml__attr_value">&quot;buttonPreviewClick&quot;</span>&nbsp;<span class="xaml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;Button</span>&nbsp;&nbsp;<span class="xaml__attr_name">Content</span>=<span class="xaml__attr_value">&quot;手ブレ補正&quot;</span>&nbsp;<span class="xaml__attr_name">HorizontalAlignment</span>=<span class="xaml__attr_value">&quot;Center&quot;</span>&nbsp;<span class="xaml__attr_name">FontSize</span>=<span class="xaml__attr_value">&quot;40&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__attr_name">Click</span>=<span class="xaml__attr_value">&quot;buttonPreviewWithVideoStabilizationClick&quot;</span>&nbsp;<span class="xaml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__tag_start">&lt;Button</span>&nbsp;&nbsp;<span class="xaml__attr_name">Content</span>=<span class="xaml__attr_value">&quot;《&nbsp;撮影&nbsp;》&quot;</span>&nbsp;<span class="xaml__attr_name">HorizontalAlignment</span>=<span class="xaml__attr_value">&quot;Center&quot;</span>&nbsp;<span class="xaml__attr_name">FontSize</span>=<span class="xaml__attr_value">&quot;40&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xaml__attr_name">Click</span>=<span class="xaml__attr_value">&quot;buttonTakePhotoClick&quot;</span>&nbsp;<span class="xaml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;<span class="xaml__tag_end">&lt;/StackPanel&gt;</span>&nbsp;
&nbsp;
<span class="xaml__tag_end">&lt;/Grid&gt;</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>&nbsp;</p>
<h2>●プレビューを表示するには？</h2>
<p>次のコードで、Webカメラの画像がCaptureElementコントロールに映し出されるようになる。</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>Visual Basic</span><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">スクリプトの編集</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">vb</span><span class="hidden">csharp</span>
<pre class="hidden">Private Async Sub buttonPreviewClick(sender As Object, e As RoutedEventArgs)
  ' 静止画撮影、動画録画を行うキャプチャ・オブジェクト
  Dim _capture = New Windows.Media.Capture.MediaCapture()

  Try
    ' Webカメラの初期化
    Await _capture.InitializeAsync()

  Catch ex As UnauthorizedAccessException
    ' Webカメラがユーザーに許可されていないと、
    ' UnauthorizedAccessExceptionが出る
    Return
  End Try

  ' Effectの追加はここで行う &hellip;&hellip; （1）

  ' MediaCaptureインスタンスをCaptureElementコントロールに設定する
  capturePreview.Source = _capture

  ' プレビューを開始する
  Await _capture.StartPreviewAsync()
End Sub</pre>
<pre class="hidden">private async void buttonPreviewClick(object sender, RoutedEventArgs e)
{
  // 静止画撮影、動画録画を行うキャプチャ・オブジェクト
  var _capture = new Windows.Media.Capture.MediaCapture();

  try
  {
    // Webカメラの初期化
    await _capture.InitializeAsync();
  }
  catch (UnauthorizedAccessException ex)
  {
    // Webカメラがユーザーに許可されていないと、
    // UnauthorizedAccessException が出る
    return;
  }

  // Effectの追加はここで行う &hellip;&hellip; （1）

  // MediaCaptureインスタンスをCaptureElementコントロールに設定する
  capturePreview.Source = _capture;

  // プレビューを開始する
  await _capture.StartPreviewAsync();
}</pre>
<div class="preview">
<pre class="vb"><span class="visualBasic__keyword">Private</span>&nbsp;Async&nbsp;<span class="visualBasic__keyword">Sub</span>&nbsp;buttonPreviewClick(sender&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">Object</span>,&nbsp;e&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;RoutedEventArgs)&nbsp;
&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;静止画撮影、動画録画を行うキャプチャ・オブジェクト</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;_capture&nbsp;=&nbsp;<span class="visualBasic__keyword">New</span>&nbsp;Windows.Media.Capture.MediaCapture()&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Try</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;Webカメラの初期化</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Await&nbsp;_capture.InitializeAsync()&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Catch</span>&nbsp;ex&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;UnauthorizedAccessException&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;Webカメラがユーザーに許可されていないと、</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;UnauthorizedAccessExceptionが出る</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Return</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Try</span>&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;Effectの追加はここで行う&nbsp;&hellip;&hellip;&nbsp;（1）</span>&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;MediaCaptureインスタンスをCaptureElementコントロールに設定する</span>&nbsp;
&nbsp;&nbsp;capturePreview.Source&nbsp;=&nbsp;_capture&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;プレビューを開始する</span>&nbsp;
&nbsp;&nbsp;Await&nbsp;_capture.StartPreviewAsync()&nbsp;
<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Sub</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>&nbsp;</p>
<h2>●プレビューした画像を撮影するには？</h2>
<p>プレビューに表示されている映像から写真を撮影するには、次のようなコードを記述する。</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>Visual Basic</span><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">スクリプトの編集</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">vb</span><span class="hidden">csharp</span>
<pre class="hidden">Private Async Sub buttonTakePhotoClick(sender As Object, e As RoutedEventArgs)
  If (capturePreview.Source Is Nothing) Then
    Return
  End If

  ' プレビューに付けたMediaCaptureオブジェクトを取り出す
  Dim capture As Windows.Media.Capture.MediaCapture = capturePreview.Source

  ' 保存する画像ファイルのフォーマット（.pngファイルを指定）
  Dim imageProperties = Windows.Media.MediaProperties.ImageEncodingProperties.CreatePng()

  ' 撮影する。一度ファイルに保存する
  Dim file As StorageFile = Await
    ApplicationData.Current.TemporaryFolder.CreateFileAsync(&quot;test.png&quot;,    CreationCollisionOption.GenerateUniqueName)
  Try
    Await capture.CapturePhotoToStorageFileAsync(imageProperties, file)
    ' キャプチャ開始から撮影までの間に許可を取り消されると、ここで例外が出る
  Catch ex As Exception
    Return
  End Try

  '撮影したファイルを読み込んで右側のImageコントロールに表示する
  Using stream = Await file.OpenReadAsync()
    Dim bi = New BitmapImage()
    bi.SetSource(stream)
    captureImage.Source = bi
  End Using
End Sub</pre>
<pre class="hidden">private async void buttonTakePhotoClick(object sender, RoutedEventArgs e)
{
  if (capturePreview.Source == null)
    return;

  // プレビューに付けた MediaCapture オブジェクトを取り出す
  Windows.Media.Capture.MediaCapture capture = capturePreview.Source;
      
  // 保存する画像ファイルのフォーマット（.pngファイルを指定）
  var imageProperties 
    = Windows.Media.MediaProperties.ImageEncodingProperties.CreatePng();

  // 撮影する。一度ファイルに保存する
  StorageFile file 
    = await ApplicationData.Current.TemporaryFolder.CreateFileAsync(
      &quot;test.png&quot;, CreationCollisionOption.GenerateUniqueName);
  try
  {
    await capture.CapturePhotoToStorageFileAsync(imageProperties, file);
    // キャプチャ開始から撮影までの間に許可を取り消されると、ここで例外が出る
  }
  catch (Exception ex)
  {
    return;
  }

  // 撮影したファイルを読み込んで右側のImageコントロールに表示する
  using (var stream = await file.OpenReadAsync())
  {
    var bi = new BitmapImage();
    bi.SetSource(stream);
    captureImage.Source = bi;
  }
}</pre>
<div class="preview">
<pre class="vb"><span class="visualBasic__keyword">Private</span>&nbsp;Async&nbsp;<span class="visualBasic__keyword">Sub</span>&nbsp;buttonTakePhotoClick(sender&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">Object</span>,&nbsp;e&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;RoutedEventArgs)&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;(capturePreview.Source&nbsp;<span class="visualBasic__keyword">Is</span>&nbsp;<span class="visualBasic__keyword">Nothing</span>)&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Return</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;プレビューに付けたMediaCaptureオブジェクトを取り出す</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;capture&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;Windows.Media.Capture.MediaCapture&nbsp;=&nbsp;capturePreview.Source&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;保存する画像ファイルのフォーマット（.pngファイルを指定）</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;imageProperties&nbsp;=&nbsp;Windows.Media.MediaProperties.ImageEncodingProperties.CreatePng()&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;撮影する。一度ファイルに保存する</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;file&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;StorageFile&nbsp;=&nbsp;Await&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;ApplicationData.Current.TemporaryFolder.CreateFileAsync(<span class="visualBasic__string">&quot;test.png&quot;</span>,&nbsp;&nbsp;&nbsp;&nbsp;CreationCollisionOption.GenerateUniqueName)&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Try</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Await&nbsp;capture.CapturePhotoToStorageFileAsync(imageProperties,&nbsp;file)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;キャプチャ開始から撮影までの間に許可を取り消されると、ここで例外が出る</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Catch</span>&nbsp;ex&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;Exception&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Return</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Try</span>&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="visualBasic__com">'撮影したファイルを読み込んで右側のImageコントロールに表示する</span>&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">Using</span>&nbsp;stream&nbsp;=&nbsp;Await&nbsp;file.OpenReadAsync()&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;bi&nbsp;=&nbsp;<span class="visualBasic__keyword">New</span>&nbsp;BitmapImage()&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;bi.SetSource(stream)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;captureImage.Source&nbsp;=&nbsp;bi&nbsp;
&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Using</span>&nbsp;
<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Sub</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>&nbsp;</p>
<h1><span>Source Code Files</span></h1>
<ul>
<li><em>MainPage.xaml - CaptureElement コントロールを使ったプレビューと、 Image コントロールによる撮影結果を表示する画面</em>
</li><li><em>MainPage.xaml.cs/.vb - CameraCaptureUI クラスとMediaCaptureクラスによる写真撮影</em> </li></ul>
<h1>More Information</h1>
<h2>著作権について</h2>
<div>このソースコードは MS-LPL ライセンスで提供しておりますので、 ご自由に利用いただけます。<br>
ただし、@ITの記事(ここへ転載・引用した部分も含む)そのものの著作権は、筆者とデジタルアドバンテージが保有しており、サンプルコード部分を除く記事の無断使用は固くお断りいたします。</div>

</div>


    </div>
</body>
</html>
