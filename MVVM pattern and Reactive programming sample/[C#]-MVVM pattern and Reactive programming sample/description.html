<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=535362C486571614CCA1B8A3C2E9DA1A" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:FooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=767FA1F2FD72542D532E6E1E2F77B0E8" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>MVVM pattern and Reactive programming sample</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>MVVM pattern and Reactive programming sample</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            WPF, MVVM, ReactivePropert<wbr />y
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            MVVM
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">8/28/2015</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MIT</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/MVVM-pattern-and-Reactive-2f71560a">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p>This sample program has been made with Model View ViewModel pattern and Reactive Programming.&nbsp;</p>
<p>MVVM Light Toolkit is used for the Model View ViewModel pattern. Reactive Extensions is used for the Reactive Programming.ReactiveProperty is used for the MVVM &#43; Rx.</p>
<ul>
<li>MVVM Light Toolkit<br>
https://mvvmlight.codeplex.com/ </li><li>Reactive Extensions<br>
https://rx.codeplex.com/ </li><li>ReactiveProperty<br>
https://github.com/runceel/ReactiveProperty </li></ul>
<h2>How to use</h2>
<p>When 'add' button clicked, a new record is inserted into DataGrid.</p>
<p><img id="133818" alt="" src="https://i1.code.msdn.s-msft.com/mvvm-pattern-and-reactive-2f71560a/image/file/133818/1/figure1.png" width="398" height="257"></p>
<p>When record is selected and 'edit' button is &nbsp;clicked, then edit dialog is displayed..</p>
<p><img id="133819" alt="" src="https://i1.code.msdn.s-msft.com/mvvm-pattern-and-reactive-2f71560a/image/file/133819/1/figure2.png" width="397" height="257"></p>
<ul>
<li>Update button<br>
Update data and close window.&nbsp; </li><li>Delete button<br>
Delete data and close window.&nbsp; </li><li>Cancel button<br>
Close window.&nbsp; </li></ul>
<h1>Building the Sample</h1>
<ol>
<li>Download sample program. </li><li>Restore NuGet package. </li><li>Run application. </li></ol>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<h2>Model classes</h2>
<p>The PeopleMaster class loads Person class. The PersonDetail class provides editing functions for the Person class data.In this sample, Messenger class is used for collaborating with PeopleMaster class and PersonDetail class.</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">スクリプトの編集</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">// PersonDetail class
public void Update()
{
    this.repository.Update(this.EditTarget);
    this.messenger.Send(new PersonChangeMessage(ChangeKind.Update, this.EditTarget));
}

public void Delete()
{
    this.repository.Delete(this.EditTarget.Id);
    this.messenger.Send(new PersonChangeMessage(ChangeKind.Delete, this.EditTarget));
}


// PeopleMaster class
private void PersonChangedReceived(PersonChangeMessage message)
{
    switch (message.ChangeKind)
    {
        case ChangeKind.Delete:
            this.People.Remove(this.People.First(x =&gt; x.Id == message.Content.Id));
            break;
        case ChangeKind.Update:
            var p = this.People.First(x =&gt; x.Id == message.Content.Id);
            p.Name = message.Content.Name;
            p.Age = message.Content.Age;
            break;
    }
}
</pre>
<div class="preview">
<pre class="csharp"><span class="cs__com">//&nbsp;PersonDetail&nbsp;class</span>&nbsp;
<span class="cs__keyword">public</span>&nbsp;<span class="cs__keyword">void</span>&nbsp;Update()&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">this</span>.repository.Update(<span class="cs__keyword">this</span>.EditTarget);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">this</span>.messenger.Send(<span class="cs__keyword">new</span>&nbsp;PersonChangeMessage(ChangeKind.Update,&nbsp;<span class="cs__keyword">this</span>.EditTarget));&nbsp;
}&nbsp;
&nbsp;
<span class="cs__keyword">public</span>&nbsp;<span class="cs__keyword">void</span>&nbsp;Delete()&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">this</span>.repository.Delete(<span class="cs__keyword">this</span>.EditTarget.Id);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">this</span>.messenger.Send(<span class="cs__keyword">new</span>&nbsp;PersonChangeMessage(ChangeKind.Delete,&nbsp;<span class="cs__keyword">this</span>.EditTarget));&nbsp;
}&nbsp;
&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;PeopleMaster&nbsp;class</span>&nbsp;
<span class="cs__keyword">private</span>&nbsp;<span class="cs__keyword">void</span>&nbsp;PersonChangedReceived(PersonChangeMessage&nbsp;message)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">switch</span>&nbsp;(message.ChangeKind)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">case</span>&nbsp;ChangeKind.Delete:&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">this</span>.People.Remove(<span class="cs__keyword">this</span>.People.First(x&nbsp;=&gt;&nbsp;x.Id&nbsp;==&nbsp;message.Content.Id));&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">break</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">case</span>&nbsp;ChangeKind.Update:&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;p&nbsp;=&nbsp;<span class="cs__keyword">this</span>.People.First(x&nbsp;=&gt;&nbsp;x.Id&nbsp;==&nbsp;message.Content.Id);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.Name&nbsp;=&nbsp;message.Content.Name;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.Age&nbsp;=&nbsp;message.Content.Age;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">break</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
}&nbsp;
</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>&nbsp;</p>
<h2>ViewModel classes</h2>
<p>ViewModel classes use ReactiveProperty. ReactiveProperty instance is created from Model instance which implements INotifyPropertyChanged interface.</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">スクリプトの編集</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">// Name is ReactiveProperty&lt;string&gt;.
this.Name = this.Person.ObserveProperty(x =&gt; x.Name)
    .ToReactiveProperty()
    .SetValidateAttribute(() =&gt; this.Name);
</pre>
<div class="preview">
<pre class="csharp"><span class="cs__com">//&nbsp;Name&nbsp;is&nbsp;ReactiveProperty&lt;string&gt;.</span>&nbsp;
<span class="cs__keyword">this</span>.Name&nbsp;=&nbsp;<span class="cs__keyword">this</span>.Person.ObserveProperty(x&nbsp;=&gt;&nbsp;x.Name)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;.ToReactiveProperty()&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;.SetValidateAttribute(()&nbsp;=&gt;&nbsp;<span class="cs__keyword">this</span>.Name);&nbsp;
</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>&nbsp;</p>
<p>And ReactiveCommand is converted from IObservable&lt;bool&gt;. It performs the processing in the Subscribe method.</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">スクリプトの編集</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">// MainWindowViewModel constructor.
this.EditCommand = this.SelectedPerson
    .Select(x =&gt; x != null)
    .ToReactiveCommand();
this.EditCommand.Subscribe(_ =&gt; 
    {
        app.Detail.SetEditTarget(this.SelectedPerson.Value.Person.Id);
        this.MessengerInstance.Send(new MessageBase(this, &quot;EditWindow&quot;));
    });
</pre>
<div class="preview">
<pre class="csharp"><span class="cs__com">//&nbsp;MainWindowViewModel&nbsp;constructor.</span>&nbsp;
<span class="cs__keyword">this</span>.EditCommand&nbsp;=&nbsp;<span class="cs__keyword">this</span>.SelectedPerson&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;.Select(x&nbsp;=&gt;&nbsp;x&nbsp;!=&nbsp;<span class="cs__keyword">null</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;.ToReactiveCommand();&nbsp;
<span class="cs__keyword">this</span>.EditCommand.Subscribe(_&nbsp;=&gt;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.Detail.SetEditTarget(<span class="cs__keyword">this</span>.SelectedPerson.Value.Person.Id);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">this</span>.MessengerInstance.Send(<span class="cs__keyword">new</span>&nbsp;MessageBase(<span class="cs__keyword">this</span>,&nbsp;<span class="cs__string">&quot;EditWindow&quot;</span>));&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;});&nbsp;
</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>ReactiveProperty can bind View - ViewModel - Model very easily. It's really powerful. Please try to use!</p>

</div>


    </div>
</body>
</html>
