<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,1:ImageSprite,2:LinkList;/Areas/Epx/Themes/WindowsAzure/Content:0,/Areas/Epx/Themes/WindowsAzure/Content/SpriteImages:1,/Areas/Epx/Themes/Base/Content:2&amp;amp;hashKey=CCA529A7D95F51996C70B60AA6D40289" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/e8399f8f-db79-449b-835b-5154ed64d3cdCombined.css,1:ImageSprite,2:LinkList,2:SelectLocaleFromPopUp;/Areas/Epx/Themes/WindowsAzure/Content:0,/Areas/Epx/Themes/WindowsAzure/Content/SpriteImages:1,/Areas/Epx/Themes/Base/Content:2&amp;amp;hashKey=AB7D04457C9289CE30F3302613C00319" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Managing Concurrency using Azure Storage - Sample Application</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" /><link href="description/97f93464-9aa6-4576-a835-eaf27f4ae193Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Managing Concurrency using Azure Storage - Sample Application</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Windows Azure Storage, Windows Azure Storage Blobs, Windows Azure Storage Tables, Microsoft Azure Storage
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            C#, Azure, Microsoft Azure, Azure Table Storage, Code Sample, Table Storage, Windows Azure Application, Azure Blob Storage, Storage, Windows Azure Web Sites, data and storage, Microsoft Azure Storage, Windows Azure Storage Client Library
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Web, Cloud, Phone, Data, Xbox, Windows RT
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">8/20/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/windowsazure/Managing-Concurrency-using-56018114">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p><em>Modern Internet based applications usually have multiple users viewing and updating data simulataneously. This requires application developers to think carefully about how to provide a predictable experience to their end users, particularly for scenarios
 where multiple users can update the same data. The Azure Storage Service includes support for optimistic, pessimistic and last-writer-wins concurrency strategies. This sample application developed to accompany the Azure blog post demonstrates these capabilities.
</em></p>
<h1><span>Building the Sample</span></h1>
<p><em>1. Unzip the zip file </em></p>
<p><em>2. Open the solution in Visual Studio</em></p>
<p><em>3. Modify the app.config file to include your storage account and access key</em><em><br>
</em></p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p><em>&nbsp;</em><em>The sample demonstrates optimistic and pessimistic locking strategies with blob storage. It also simulates a third party modifying the backend data to force concurrency execeptions.
</em></p>
<p><em>The sample also demonstrates how optimistic concurrency is supported using Table storage - as well as how to change the default behavior from optimistic concurrency to last-writer wins.
</em></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">// Try to update the blob using the ETag provided 
try
{
     Console.WriteLine(&quot;Trying to update blob using orignal etag to generate if-match access condition&quot;);
     blockBlob.UploadText(helloText, accessCondition:AccessCondition.GenerateIfMatchCondition(orignalETag));
}
catch (StorageException ex)
{
     if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
          Console.WriteLine(&quot;Precondition failure as expected. Blob's orignal etag no longer matches&quot;);
     else
          throw;
}
</pre>
<div class="preview">
<pre class="csharp"><span class="cs__com">//&nbsp;Try&nbsp;to&nbsp;update&nbsp;the&nbsp;blob&nbsp;using&nbsp;the&nbsp;ETag&nbsp;provided&nbsp;</span>&nbsp;
<span class="cs__keyword">try</span>&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(<span class="cs__string">&quot;Trying&nbsp;to&nbsp;update&nbsp;blob&nbsp;using&nbsp;orignal&nbsp;etag&nbsp;to&nbsp;generate&nbsp;if-match&nbsp;access&nbsp;condition&quot;</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blockBlob.UploadText(helloText,&nbsp;accessCondition:AccessCondition.GenerateIfMatchCondition(orignalETag));&nbsp;
}&nbsp;
<span class="cs__keyword">catch</span>&nbsp;(StorageException&nbsp;ex)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">if</span>&nbsp;(ex.RequestInformation.HttpStatusCode&nbsp;==&nbsp;(<span class="cs__keyword">int</span>)HttpStatusCode.PreconditionFailed)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(<span class="cs__string">&quot;Precondition&nbsp;failure&nbsp;as&nbsp;expected.&nbsp;Blob's&nbsp;orignal&nbsp;etag&nbsp;no&nbsp;longer&nbsp;matches&quot;</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">else</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">throw</span>;&nbsp;
}&nbsp;
</pre>
</div>
</div>
</div>
<h1><span>Source Code Files</span></h1>
<ul>
<li><em>blobsample.cs - blob storage sample code</em> </li><li><em><em>tablesample.cs - table storage sample code</em></em> </li></ul>
<h1>More Information</h1>
<p><em>For more information on Azure Storage see:</em></p>
<ul>
<li><em>Managing Concurrency using Azure Storage</em> </li><li><em>Microsoft Azure Storage Home Page<br>
</em></li><li><em>Introduction to Azure Storage <br>
</em></li><li><em>Storage Getting Started for Blob, Table and Queues <br>
</em></li><li><em>Storage Architecture &ndash; Windows Azure Storage : A Highly Available Cloud Storage Service with Strong Consistency<br>
<br>
</em></li></ul>
<p>&nbsp;</p>
<p><em><br>
</em></p>
<div id="_mcePaste" class="mcePaste" style="left:-10000px; top:0px; width:1px; height:1px; overflow:hidden">
</div>

</div>


    </div>
</body>
</html>
